# CoAP (Constrained Application Protocol)

CoAP 제약이 있는 장치들을 위한 특수한 internet application protocol로서 RFC 7252에 정의되었다.

Node로 불리는 해당 제약 장치들이 비슷한 protocol을 사용하는 더 넓은 internet과 통신할 수 있게 한다. CoAP은 제약이 있는 동일한 network의 장치들 간에, 장치와 internet 상의 일반 node 간에, 또 internet을 통해 참여한, 제약이 있는 각기 다른 network 상의 장치 간에 사용하기 위해 설계되었다. 또, CoAP은 mobile 통신망의 SMS와 같은 다른 구조를 통해 사용되기도 한다.

CoAP은 무선 sensor network node처럼 자원에 제약이 있는 장치들에서 사용할 목적으로 고안된 service 계층 protocol이다. CoAP은 단순한 web 연동을 위해 HTTP로 쉽게 변환되도록 설계되어 있으며 multicast 지원과 같은 특수한 요건을 충족하면서도 부하가 매우 낮으며 단순한 편이다. Multicast, 낮은 부하, 단순성은 심도있게 embedded되는 경향이 있고 전통적인 internet 장치보다 훨씬 더 적은 memory와 전력 공급을 지니는 경향이 있는 IoT 및 M2M 장치에 매우 중요하다. 즉, 효율성이 매우 중요하다. CoAP은 UDP 또는 UDP 유사 protocol을 지원하는 대부분의 장치에서 구동할 수 있다.

## Message Format

### CoAP 요청/응답 Code

요청 code는 다음의 형태를 취한다.

```
+-------------------------------+
|             Byte              |
+---+---+---+---+---+---+---+---+
| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---+---+---+---+---+---+---+---+
|   CLASS   |       CODE        |
+-----------+-------------------+
```

문서 상에서는 보통 `<class>`.`<code>`와 같은 형태로 표현된다.

### CoAP Message 구조

```
+-------------------------------+-------------------------------+-------------------------------+-------------------------------+
|             Byte              |             Byte              |             Byte              |             Byte              |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|  VER  | TYPE  |      TKL      |     CoAP 요청/응답 Code       |  Message ID                                                   |
+-------+-------+---------------+-------------------------------+---------------------------------------------------------------+
|                                                      Token (Max. 8bytes)                                                      |
+-------------------------------------------------------------------------------------------------------------------------------+
|                                                            Options                                                            |
+---+---+---+---+---+---+---+---+-----------------------------------------------------------------------------------------------+
| 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |                                           Payloads                                            |
+---+---+---+---+---+---+---+---+-----------------------------------------------------------------------------------------------+
```
* TKL : Token Length
